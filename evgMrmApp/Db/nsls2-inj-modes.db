#! Generated by VisualDCT v2.6
#! DBDSTART
#! DBD("../../dbd/mrf.dbd")
#! DBDEND



record(mbboDirect, "$(LN){}Mode:Prmt-Sel") {
  field(DESC, "LN Permitted TS Modes")
  field(FLNK, "$(LN){}Mode:Prmt-Calc_")
}


record(calcout, "$(LN){}Mode:Prmt-Calc_") {
  field(FLNK, "$(INJ){}Mode-RB_")
  field(CALC, "A&B")
  field(INPB, "$(LN){}Mode:Prmt-Sel PP MS")
  field(OUT, "$(LN){Seq}Mask:Rep-SP PP")
  field(IVOA, "Set output to IVOV")
  field(IVOV, "0")
}


record(bi, "$(INJ){}Mode:Allw-Sts") {
  field(DESC, "TS modes permits inject")
  field(INP, "$(INJ){}Mode:Allw1-Calc_ NPP MS")
  field(ZSV, "MINOR")
  field(ZNAM, "BR Inj Denied")
  field(ONAM, "BR Inj Allowed")
}

# User Control
record(mbbo, "$(LN){}Mode-Sel") {
  field(DTYP, "Raw Soft Channel")
  field(OUT, "$(LN){}Mode:Prmt-Calc_.A PP MS")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "3")
  field(THVL, "0x21")
  field(FRVL, "0x155")
  field(FVVL, "0x3ff")
  field(ZRST, "Off")
  field(ONST, "1 Hz")
  field(TWST, "Stack")
  field(THST, "2 Hz")
  field(FRST, "5 Hz")
  field(FVST, "10 Hz")
}

# User Control
record(mbbo, "$(BR){}Mode-Sel") {
  field(OUT, "$(BR){}Mode:Prmt1-Calc_.A PP MS")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "1")
  field(THVL, "6")
  field(ZRST, "Off")
  field(ONST, "1 Hz")
  field(TWST, "Stack")
  field(THST, "2 Hz")
}

record(mbboDirect, "$(BR){}Mode:Prmt-Sel") {
  field(DESC, "LN Permitted TS Modes")
  field(FLNK, "$(BR){}Mode:Prmt1-Calc_")
}

# Seperate BR 1Hz and 2Hz patterns
record(calcout, "$(BR){}Mode:Prmt1-Calc_") {
  field(FLNK, "$(BR){}Mode:Prmt2-Calc_")
  field(CALC, "C:=A&B;D:=C>>1;C&1")
  field(INPB, "$(BR){}Mode:Prmt-Sel PP MS")
  field(OUT, "$(BR){Seq:1Hz}Mask:Rep-SP PP")
  field(IVOA, "Set output to IVOV")
  field(IVOV, "0")
}


record(calcout, "$(BR){}Mode:Prmt2-Calc_") {
  field(FLNK, "$(INJ){}Mode-RB_")
  field(CALC, "A")
  field(INPA, "$(BR){}Mode:Prmt1-Calc_.D NPP MS")
  field(OUT, "$(BR){Seq:2Hz}Mask:Rep-SP")
  field(IVOA, "Set output to IVOV")
  field(IVOV, "0")
}


record(calcout, "$(INJ){}Mode-RB_") {
  field(FLNK, "$(INJ){}Mode-RB")
  field(CALC, "(A&0x3ff)<<3|(B&7)")
  field(INPA, "$(LN){}Mode:Prmt-Calc_ NPP MS")
  field(INPB, "$(BR){}Mode:Prmt1-Calc_.C MS")
  field(OUT, "$(INJ){}Mode:Allw1-Calc_.A PP MS")
}


record(mbbiDirect, "$(INJ){}Mode-RB") {
  field(NOBT, "13")
  field(INP, "$(INJ){}Mode-RB_ NPP MS")
}


record(bo, "$(INJ){}Mode:Prmt-Sel") {
  field(ZNAM, "Inhibit BR Inject")
  field(ONAM, "Require BR Inject")
}

# Compare against modes which allow BR injection
record(calcout, "$(INJ){}Mode:Allw1-Calc_") {
  field(FLNK, "$(INJ){}Mode:Allw-Sts")
  field(CALC, "(A==B)||(A==C)||(A==D)")
  field(INPB, "0x9")
  field(INPC, "0x19")
  field(INPD, "0x10e")
  field(OUT, "$(INJ){}Mode:Allw2-Calc_.A PP MS")
}

record(calcout, "$(INJ){}Mode:Allw2-Calc_") {
  field(CALC, "B&&!A")
  field(INPB, "$(INJ){}Mode:Prmt-Sel PP MS")
  field(OUT, "$(INJ){}Mode:Prmt-Sts PP MS")
}


record(bi, "$(INJ){}Mode:Prmt-Sts") {
  field(ZSV, "MAJOR")
  field(ZNAM, "Incompatible modes")
  field(ONAM, "OK")
}


record(bo, "$(INJ){}Mode:Commit-Cmd") {
  field(FLNK, "$(INJ){}Mode:Commit-Calc_")
  field(ZNAM, "Commit")
  field(ONAM, "Commit")
}

# Only allow commit operation if mode validation allows
record(calcout, "$(INJ){}Mode:Commit-Calc_") {
  field(CALC, "A")
  field(INPA, "$(INJ){}Mode:Prmt-Sts PP MS")
  field(OUT, "$(EVG)Commit-Cmd PP")
  field(OOPT, "Transition To Non-zero")
  field(DOPT, "Use OCAL")
  field(OCAL, "1")
  field(IVOA, "Don't drive outputs")
}

#! Further lines contain data used by VisualDCT
#! View(2980,2227,1.0)
#! Record("$(LN){}Mode:Prmt-Sel",2620,2036,0,1,"$(LN){}Mode:Prmt-Sel")
#! Field("$(LN){}Mode:Prmt-Sel.VAL",16777215,0,"$(LN){}Mode:Prmt-Sel.VAL")
#! Field("$(LN){}Mode:Prmt-Sel.FLNK",16777215,1,"$(LN){}Mode:Prmt-Sel.FLNK")
#! Link("$(LN){}Mode:Prmt-Sel.FLNK","$(LN){}Mode:Prmt-Calc_")
#! Record("$(LN){}Mode:Prmt-Calc_",2660,2180,0,1,"$(LN){}Mode:Prmt-Calc_")
#! Field("$(LN){}Mode:Prmt-Calc_.INPB",16777215,0,"$(LN){}Mode:Prmt-Calc_.INPB")
#! Link("$(LN){}Mode:Prmt-Calc_.INPB","$(LN){}Mode:Prmt-Sel.VAL")
#! Field("$(LN){}Mode:Prmt-Calc_.OUT",16777215,1,"$(LN){}Mode:Prmt-Calc_.OUT")
#! Field("$(LN){}Mode:Prmt-Calc_.A",16777215,0,"$(LN){}Mode:Prmt-Calc_.A")
#! Field("$(LN){}Mode:Prmt-Calc_.FLNK",16777215,1,"$(LN){}Mode:Prmt-Calc_.FLNK")
#! Link("$(LN){}Mode:Prmt-Calc_.FLNK","$(INJ){}Mode-RB_")
#! Field("$(LN){}Mode:Prmt-Calc_.VAL",16777215,1,"$(LN){}Mode:Prmt-Calc_.VAL")
#! Record("$(INJ){}Mode:Allw-Sts",3400,2234,0,0,"$(INJ){}Mode:Allw-Sts")
#! Field("$(INJ){}Mode:Allw-Sts.INP",16777215,1,"$(INJ){}Mode:Allw-Sts.INP")
#! Link("$(INJ){}Mode:Allw-Sts.INP","$(INJ){}Mode:Allw1-Calc_.VAL")
#! TextBox(TB0,2320,2060,2500,2100,0,"Dialog",24,1,16724787,"User Control",null)
#! TextBox(TB1,2340,2640,2520,2680,0,"Dialog",24,1,16724787,"User Control",null)
#! Record("$(LN){}Mode-Sel",2340,2109,0,1,"$(LN){}Mode-Sel")
#! Field("$(LN){}Mode-Sel.OUT",16777215,1,"$(LN){}Mode-Sel.OUT")
#! Link("$(LN){}Mode-Sel.OUT","$(LN){}Mode:Prmt-Calc_.A")
#! Record("$(BR){}Mode-Sel",2340,2679,0,1,"$(BR){}Mode-Sel")
#! Field("$(BR){}Mode-Sel.OUT",16777215,1,"$(BR){}Mode-Sel.OUT")
#! Link("$(BR){}Mode-Sel.OUT","$(BR){}Mode:Prmt1-Calc_.A")
#! Record("$(BR){}Mode:Prmt-Sel",2620,2556,0,1,"$(BR){}Mode:Prmt-Sel")
#! Field("$(BR){}Mode:Prmt-Sel.VAL",16777215,0,"$(BR){}Mode:Prmt-Sel.VAL")
#! Field("$(BR){}Mode:Prmt-Sel.FLNK",16777215,1,"$(BR){}Mode:Prmt-Sel.FLNK")
#! Link("$(BR){}Mode:Prmt-Sel.FLNK","$(BR){}Mode:Prmt1-Calc_")
#! Record("$(BR){}Mode:Prmt1-Calc_",2660,2700,0,1,"$(BR){}Mode:Prmt1-Calc_")
#! Field("$(BR){}Mode:Prmt1-Calc_.INPB",16777215,0,"$(BR){}Mode:Prmt1-Calc_.INPB")
#! Link("$(BR){}Mode:Prmt1-Calc_.INPB","$(BR){}Mode:Prmt-Sel.VAL")
#! Field("$(BR){}Mode:Prmt1-Calc_.A",16777215,0,"$(BR){}Mode:Prmt1-Calc_.A")
#! Field("$(BR){}Mode:Prmt1-Calc_.OUT",16777215,1,"$(BR){}Mode:Prmt1-Calc_.OUT")
#! Field("$(BR){}Mode:Prmt1-Calc_.FLNK",16777215,1,"$(BR){}Mode:Prmt1-Calc_.FLNK")
#! Link("$(BR){}Mode:Prmt1-Calc_.FLNK","$(BR){}Mode:Prmt2-Calc_")
#! Field("$(BR){}Mode:Prmt1-Calc_.D",16777215,1,"$(BR){}Mode:Prmt1-Calc_.D")
#! Field("$(BR){}Mode:Prmt1-Calc_.C",16777215,1,"$(BR){}Mode:Prmt1-Calc_.C")
#! Record("$(BR){}Mode:Prmt2-Calc_",2940,2840,0,0,"$(BR){}Mode:Prmt2-Calc_")
#! Field("$(BR){}Mode:Prmt2-Calc_.INPA",16777215,0,"$(BR){}Mode:Prmt2-Calc_.INPA")
#! Link("$(BR){}Mode:Prmt2-Calc_.INPA","$(BR){}Mode:Prmt1-Calc_.D")
#! Field("$(BR){}Mode:Prmt2-Calc_.OUT",16777215,1,"$(BR){}Mode:Prmt2-Calc_.OUT")
#! Field("$(BR){}Mode:Prmt2-Calc_.FLNK",16777215,1,"$(BR){}Mode:Prmt2-Calc_.FLNK")
#! Link("$(BR){}Mode:Prmt2-Calc_.FLNK","$(INJ){}Mode-RB_")
#! Record("$(INJ){}Mode-RB_",3100,2394,0,1,"$(INJ){}Mode-RB_")
#! Field("$(INJ){}Mode-RB_.INPA",16777215,0,"$(INJ){}Mode-RB_.INPA")
#! Link("$(INJ){}Mode-RB_.INPA","$(LN){}Mode:Prmt-Calc_.VAL")
#! Field("$(INJ){}Mode-RB_.INPB",16777215,0,"$(INJ){}Mode-RB_.INPB")
#! Link("$(INJ){}Mode-RB_.INPB","$(BR){}Mode:Prmt1-Calc_.C")
#! Field("$(INJ){}Mode-RB_.VAL",16777215,0,"$(INJ){}Mode-RB_.VAL")
#! Field("$(INJ){}Mode-RB_.OUT",16777215,1,"$(INJ){}Mode-RB_.OUT")
#! Link("$(INJ){}Mode-RB_.OUT","$(INJ){}Mode:Allw1-Calc_.A")
#! Field("$(INJ){}Mode-RB_.FLNK",16777215,0,"$(INJ){}Mode-RB_.FLNK")
#! Link("$(INJ){}Mode-RB_.FLNK","$(INJ){}Mode-RB")
#! Record("$(INJ){}Mode-RB",3100,2676,0,0,"$(INJ){}Mode-RB")
#! Field("$(INJ){}Mode-RB.INP",16777215,0,"$(INJ){}Mode-RB.INP")
#! Link("$(INJ){}Mode-RB.INP","$(INJ){}Mode-RB_.VAL")
#! Record("$(INJ){}Mode:Prmt-Sel",3740,2196,0,1,"$(INJ){}Mode:Prmt-Sel")
#! Field("$(INJ){}Mode:Prmt-Sel.VAL",16777215,0,"$(INJ){}Mode:Prmt-Sel.VAL")
#! Record("$(INJ){}Mode:Allw1-Calc_",3420,2400,0,1,"$(INJ){}Mode:Allw1-Calc_")
#! Field("$(INJ){}Mode:Allw1-Calc_.VAL",16777215,1,"$(INJ){}Mode:Allw1-Calc_.VAL")
#! Field("$(INJ){}Mode:Allw1-Calc_.FLNK",16777215,0,"$(INJ){}Mode:Allw1-Calc_.FLNK")
#! Link("$(INJ){}Mode:Allw1-Calc_.FLNK","$(INJ){}Mode:Allw-Sts")
#! Field("$(INJ){}Mode:Allw1-Calc_.A",16777215,0,"$(INJ){}Mode:Allw1-Calc_.A")
#! Field("$(INJ){}Mode:Allw1-Calc_.OUT",16777215,1,"$(INJ){}Mode:Allw1-Calc_.OUT")
#! Link("$(INJ){}Mode:Allw1-Calc_.OUT","$(INJ){}Mode:Allw2-Calc_.A")
#! Record("$(INJ){}Mode:Allw2-Calc_",3740,2422,0,1,"$(INJ){}Mode:Allw2-Calc_")
#! Field("$(INJ){}Mode:Allw2-Calc_.INPB",16777215,0,"$(INJ){}Mode:Allw2-Calc_.INPB")
#! Link("$(INJ){}Mode:Allw2-Calc_.INPB","$(INJ){}Mode:Prmt-Sel.VAL")
#! Field("$(INJ){}Mode:Allw2-Calc_.A",16777215,0,"$(INJ){}Mode:Allw2-Calc_.A")
#! Field("$(INJ){}Mode:Allw2-Calc_.OUT",16777215,1,"$(INJ){}Mode:Allw2-Calc_.OUT")
#! Link("$(INJ){}Mode:Allw2-Calc_.OUT","$(INJ){}Mode:Prmt-Sts.VAL")
#! Record("$(INJ){}Mode:Prmt-Sts",3780,2602,0,1,"$(INJ){}Mode:Prmt-Sts")
#! Field("$(INJ){}Mode:Prmt-Sts.VAL",16777215,1,"$(INJ){}Mode:Prmt-Sts.VAL")
#! Record("$(INJ){}Mode:Commit-Cmd",3460,2782,0,1,"$(INJ){}Mode:Commit-Cmd")
#! Field("$(INJ){}Mode:Commit-Cmd.FLNK",16777215,1,"$(INJ){}Mode:Commit-Cmd.FLNK")
#! Link("$(INJ){}Mode:Commit-Cmd.FLNK","$(INJ){}Mode:Commit-Calc_")
#! TextBox(TB2,3460,2740,3640,2780,0,"Dialog",24,1,16724787,"User Control",null)
#! Record("$(INJ){}Mode:Commit-Calc_",3780,2806,0,0,"$(INJ){}Mode:Commit-Calc_")
#! Field("$(INJ){}Mode:Commit-Calc_.INPA",16777215,0,"$(INJ){}Mode:Commit-Calc_.INPA")
#! Link("$(INJ){}Mode:Commit-Calc_.INPA","$(INJ){}Mode:Prmt-Sts.VAL")
#! Field("$(INJ){}Mode:Commit-Calc_.OUT",16777215,1,"$(INJ){}Mode:Commit-Calc_.OUT")
#! TextBox(TB3,2620,2000,2800,2040,0,"Dialog",24,1,16724787,"User Control",null)
#! TextBox(TB4,2620,2520,2800,2560,0,"Dialog",24,1,16724787,"User Control",null)
